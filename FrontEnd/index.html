<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>CrediGuard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/inter@3.3.1/400.css">
  <link rel="stylesheet" href="CSS/dark.css">
  <link rel="stylesheet" href="CSS/style.css">
  <link rel="stylesheet" href="CSS/leaflet.css">
  <link rel="stylesheet" href="css/leaflet.awesome-markers.css">
</head>


<body class="antialiased text-gray-800">
  <!-- Navbar -->
  <header class="flex items-center px-6 py-4 shadow-sm rounded-b-lg mb-8 header-transparent">
    <img src="Image/LOGO_CARD-removebg-preview.png" alt="CrediGuard Logo" class="h-12 w-12 mr-3"
      style="height: 250px; width: auto; margin-right: 24px;">
  </header>
  <form id="fraudForm" class="space-y-8 mt-2 blur-bg rounded-2xl mx-auto p-8 custom-form-width">
    <h2><b>Transaction Details</b></h2>
    <div class="container preload" style="margin-left: 35%;">
      <div class="creditcard">
        <div class="front">
          <div id="ccsingle"></div>
          <svg version="1.1" id="cardfront" xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 750 471" class="svg-background">
            <g id="Front">
              <g id="CardBackground">
                <g id="Page-1_1_">
                  <g id="amex_1_">
                    <path id="Rectangle-1_1_" class="lightcolor grey" d="M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40
                                C0,17.9,17.9,0,40,0z" />
                  </g>
                </g>
                <path class="darkcolor greydark"
                  d="M750,431V193.2c-217.6-57.5-556.4-13.5-750,24.9V431c0,22.1,17.9,40,40,40h670C732.1,471,750,453.1,750,431z" />
              </g>
              <text transform="matrix(1 0 0 1 60.106 295.0121)" id="svgnumber" class="st2 st3 st4">0123 4567 8910
                1112</text>
              <text transform="matrix(1 0 0 1 54.1064 428.1723)" id="svgname" class="st2 st5 st6">******* ******
                ****</text>
              <text transform="matrix(1 0 0 1 54.1074 389.8793)" class="st7 st5 st8">cardholder name</text>
              <text transform="matrix(1 0 0 1 479.7754 388.8793)" class="st7 st5 st8">expiration</text>
              <text transform="matrix(1 0 0 1 65.1054 241.5)" class="st7 st5 st8">card number</text>
              <g>
                <text transform="matrix(1 0 0 1 574.4219 433.8095)" id="svgexpire" class="st2 st5 st9">**/**</text>
                <text transform="matrix(1 0 0 1 479.3848 417.0097)" class="st2 st10 st11">VALID</text>
                <text transform="matrix(1 0 0 1 479.3848 435.6762)" class="st2 st10 st11">THRU</text>
                <polygon class="st2" points="554.5,421 540.4,414.2 540.4,427.9 		" />
              </g>
              <g id="cchip">
                <g>
                  <path class="st2" d="M168.1,143.6H82.9c-10.2,0-18.5-8.3-18.5-18.5V74.9c0-10.2,8.3-18.5,18.5-18.5h85.3
                            c10.2,0,18.5,8.3,18.5,18.5v50.2C186.6,135.3,178.3,143.6,168.1,143.6z" />
                </g>
                <g>
                  <g>
                    <rect x="82" y="70" class="st12" width="1.5" height="60" />
                  </g>
                  <g>
                    <rect x="167.4" y="70" class="st12" width="1.5" height="60" />
                  </g>
                  <g>
                    <path class="st12" d="M125.5,130.8c-10.2,0-18.5-8.3-18.5-18.5c0-4.6,1.7-8.9,4.7-12.3c-3-3.4-4.7-7.7-4.7-12.3
                                c0-10.2,8.3-18.5,18.5-18.5s18.5,8.3,18.5,18.5c0,4.6-1.7,8.9-4.7,12.3c3,3.4,4.7,7.7,4.7,12.3
                                C143.9,122.5,135.7,130.8,125.5,130.8z M125.5,70.8c-9.3,0-16.9,7.6-16.9,16.9c0,4.4,1.7,8.6,4.8,11.8l0.5,0.5l-0.5,0.5
                                c-3.1,3.2-4.8,7.4-4.8,11.8c0,9.3,7.6,16.9,16.9,16.9s16.9-7.6,16.9-16.9c0-4.4-1.7-8.6-4.8-11.8l-0.5-0.5l0.5-0.5
                                c3.1-3.2,4.8-7.4,4.8-11.8C142.4,78.4,134.8,70.8,125.5,70.8z" />
                  </g>
                  <g>
                    <rect x="82.8" y="82.1" class="st12" width="25.8" height="1.5" />
                  </g>
                  <g>
                    <rect x="82.8" y="117.9" class="st12" width="26.1" height="1.5" />
                  </g>
                  <g>
                    <rect x="142.4" y="82.1" class="st12" width="25.8" height="1.5" />
                  </g>
                  <g>
                    <rect x="142" y="117.9" class="st12" width="26.2" height="1.5" />
                  </g>
                </g>
              </g>
            </g>
            <g id="Back">
            </g>
          </svg>
        </div>
        <div class="back">
          <svg version="1.1" id="cardback" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            x="0px" y="0px" viewBox="0 0 750 471" style="enable-background:new 0 0 750 471;" xml:space="preserve">
            <g id="Front">
              <line class="st0" x1="35.3" y1="10.4" x2="36.7" y2="11" />
            </g>
            <g id="Back">
              <g id="Page-1_2_">
                <g id="amex_2_">
                  <path id="Rectangle-1_2_" class="darkcolor greydark" d="M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40
                            C0,17.9,17.9,0,40,0z" />
                </g>
              </g>
              <button id="toggleTheme"></button>
              <rect y="61.6" class="st2" width="750" height="78" />
              <g>
                <path class="st3" d="M701.1,249.1H48.9c-3.3,0-6-2.7-6-6v-52.5c0-3.3,2.7-6,6-6h652.1c3.3,0,6,2.7,6,6v52.5
                        C707.1,246.4,704.4,249.1,701.1,249.1z" />
                <rect x="42.9" y="198.6" class="st4" width="664.1" height="10.5" />
                <rect x="42.9" y="224.5" class="st4" width="664.1" height="10.5" />
                <path class="st5"
                  d="M701.1,184.6H618h-8h-10v64.5h10h8h83.1c3.3,0,6-2.7,6-6v-52.5C707.1,187.3,704.4,184.6,701.1,184.6z" />
              </g>
              <text transform="matrix(1 0 0 1 621.999 227.2734)" id="svgsecurity" class="st6 st7">***</text>
              <g class="st8">
                <text transform="matrix(1 0 0 1 518.083 280.0879)" class="st9 st6 st10">CVV</text>
              </g>
              <rect x="58.1" y="378.6" class="st11" width="375.5" height="13.5" />
              <rect x="58.1" y="405.6" class="st11" width="421.7" height="13.5" />
              <text transform="matrix(1 0 0 1 59.5073 228.6099)" id="svgnameback" class="st12 st13">******* ******
                ****</text>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <!-- Form Container -->
    <div class="form-container">
      <div class="field-container" hidden>
        <input id="name" maxlength="20" type="text"
          class="peer w-full px-4 pt-7 pb-2 border-2 border-gray-200 rounded-lg bg-transparent focus:border-indigo-500 focus:ring-2 focus:ring-indigo-50 outline-none transition-all duration-200">
        <label for="name" class="absolute left-4 top-2 text-gray-400 text-sm font-medium transition-all duration-200 pointer-events-none
                          peer-placeholder-shown:top-5 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500
                          peer-focus:top-2 peer-focus:text-sm peer-focus:text-indigo-600">
          Name
        </label>
      </div>
      <!-- Card Number -->
      <div class="brutalist-container"
        style="margin-top: 80px; margin-bottom: 1.5rem; margin-left: 530px; width: 100%;">
        <button id="generatecard" type="button" class="button"
          style="position: absolute; right: 2px; top: -48px; z-index: 10;">
          <span class="button__text">Generate</span>
          <span class="button__icon">
            <svg class="svg" height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M35.3 12.7c-2.89-2.9-6.88-4.7-11.3-4.7-8.84 0-15.98 7.16-15.98 16s7.14 16 15.98 16c7.45 0 13.69-5.1 15.46-12h-4.16c-1.65 4.66-6.07 8-11.3 8-6.63 0-12-5.37-12-12s5.37-12 12-12c3.31 0 6.28 1.38 8.45 3.55l-6.45 6.45h14v-14l-4.7 4.7z">
              </path>
              <path d="M0 0h48v48h-48z" fill="none"></path>
            </svg>
          </span>
        </button>
        <input id="cardnumber" type="text" pattern="[0-9 ]*" inputmode="numeric" maxlength="19" required
          placeholder="Card Number" class="brutalist-input smooth-type" style="box-sizing: border-box;" />
        <label for="cardnumber" class="brutalist-label">Card Number</label>
        <svg id="ccicon" class="ccicon" width="750" height="471" viewBox="0 0 750 471" version="1.1"
          xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        </svg>
      </div>

      <div class="field-container" hidden>
        <!-- <label for="expirationdate">Expiration (mm/yy)</label> -->
        <input id="expirationdate" type="text" pattern="[0-9]*" inputmode="numeric"
          class="peer w-full px-4 pt-7 pb-2 border-2 border-gray-200 rounded-lg bg-transparent focus:border-indigo-500 focus:ring-2 focus:ring-indigo-50 outline-none transition-all duration-200">
        <label for="expirationdate" class="absolute left-4 top-2 text-gray-400 text-sm font-medium transition-all duration-200 pointer-events-none
                          peer-placeholder-shown:top-5 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500
                          peer-focus:top-2 peer-focus:text-sm peer-focus:text-indigo-600">
          Expiration (mm/yy)
        </label>
      </div>
      <div class="field-container" hidden>
        <!-- <label for="securitycode">Security Code</label> -->
        <input id="securitycode" type="text" pattern="[0-9]*" inputmode="numeric" maxlength="3"
          class="peer w-full px-4 pt-7 pb-2 border-2 border-gray-200 rounded-lg bg-transparent focus:border-indigo-500 focus:ring-2 focus:ring-indigo-50 outline-none transition-all duration-200">
        <label for="securitycode" class="absolute left-4 top-2 text-gray-400 text-sm font-medium transition-all duration-200 pointer-events-none
                          peer-placeholder-shown:top-5 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500
                          peer-focus:top-2 peer-focus:text-sm peer-focus:text-indigo-600">
          CVV
        </label>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">


      <!-- Transaction Amount -->
      <div class="brutalist-container" style="margin-bottom: 1.5rem;margin-top: 1.5rem; width: 100%;">
        <input type="number" id="amount" name="amount" required step="0.01" min="0" max="100000000000000000000000"
          placeholder="Transaction Amount ($)" class="brutalist-input smooth-type" style="box-sizing: border-box;" />
        <label for="amount" class="brutalist-label">Transaction Amount ($)</label>
      </div>

      <!-- Transaction Time -->
      <div class="brutalist-container" style="margin-bottom: 1.5rem; margin-top: 1.5rem; width: 100%;">
        <input type="time" id="time" name="time" required placeholder="Transaction Time"
          class="brutalist-input smooth-type" style="box-sizing: border-box;" />
        <label for="time" class="brutalist-label">Transaction Time</label>
      </div>

      <!-- ZIP Code -->
      <div class="brutalist-container" style="margin-bottom: 1.5rem; margin-top: 1.5rem; width: 100%;">
        <input type="number" id="zipcode" name="zipcode" pattern="[0-9]{5}" required placeholder="ZIP Code"
          class="brutalist-input smooth-type" style="box-sizing: border-box;" />
        <label for="zipcode" class="brutalist-label">ZIP Code for Merchent</label>
      </div>

      <div class="relative flex items-center gap-4" style="margin-left: 100px;">
        <button type="button" id="get-location-btn">
          <span>Detect My Location</span>
        </button>
        <span id="user-location-status" style="margin-left: 10px; display: none;"> (Permission required)</span>
        <div id="location-result" style="margin-top: 0;"></div>
        <input type="hidden" id="user_lat" name="user_lat">
        <input type="hidden" id="user_lon" name="user_lon">
      </div>

      <!-- Gender -->
      <div class="brutalist-container" style="margin-bottom: 1.5rem; margin-top: 1.5rem; width: 100%;">
        <select id="gender" name="gender" required class="brutalist-input smooth-type" style="box-sizing: border-box;">
          <option value="" disabled selected hidden></option>
          <option value="M">Male</option>
          <option value="F">Female</option>
        </select>
        <label for="gender" class="brutalist-label">Gender</label>
      </div>



      <div class="brutalist-container" style="margin-bottom: 1.5rem; margin-top: 1.5rem; width: 100%;">
        <select id="category-grid" name="category-grid" required class="brutalist-input smooth-type"
          style="box-sizing: border-box;">
          <option value="" disabled selected hidden></option>
          <option value="entertainment">Entertainment</option>
          <option value="food_dining">Food/Dining</option>
          <option value="gas_transport">Gas/Transport</option>
          <option value="grocery_net">Grocery (Net)</option>
          <option value="grocery_pos">Grocery (POS)</option>
          <option value="health_fitness">Health/Fitness</option>
          <option value="home">Home</option>
          <option value="kids_pets">Kids/Pets</option>
          <option value="misc_net">Misc (Net)</option>
          <option value="misc_pos">Misc (POS)</option>
          <option value="personal_care">Personal Care</option>
          <option value="shopping_net">Shopping (Net)</option>
          <option value="shopping_pos">Shopping (POS)</option>
          <option value="travel">Travel</option>
        </select>
        <label for="category-grid" class="brutalist-label">Transaction Category</label>
      </div>

      <div>
        <div id="map" style="height: 600px; border-radius: 12px; margin-top: 24px;"></div>
        <script src="JS/leaflet.js"></script>

        <div class="flex justify-center mt-4">
          <div class="bg-white shadow-lg rounded-xl px-6 py-4 flex items-center gap-4 border border-indigo-100"
            style="min-width: 320px;">
            <span class="text-indigo-600 text-2xl">
              <i class="fas fa-map-marker-alt"></i>
            </span>
            <div>
              <div class="font-semibold text-gray-700 text-base">Merchant Coordinates</div>
              <div class="text-sm text-gray-500">
                <span class="font-medium">Lat:</span>
                <span id="show_merch_lat" class="text-indigo-700">-</span>
                <span class="mx-2">|</span>
                <span class="font-medium">Long:</span>
                <span id="show_merch_long" class="text-indigo-700">-</span>
              </div>
            </div>
          </div>
        </div>
        <input type="hidden" id="merch_lat" name="merch_lat">
        <input type="hidden" id="merch_long" name="merch_long">
      </div>



      <div class="flex items-center space-x-4 mt-2">
        <button type="submit" class="ui-btn" id="submitBtn" style="margin-left:80px ;">
          <span>Submit</span>
        </button>
        <span id="loadingSpinner" class="hidden ml-2">
          <svg class="animate-spin h-7 w-7 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24">
            <circle class="opacity-20" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z" />
          </svg>
        </span>
      </div>

    </div>


    <!-- Prediction Display Section -->
    <div id="resultSection" style="margin-top: 2.5rem; margin-left: 650px;"></div>
  </form>
  </div>


  <div class="fixed bottom-4 right-4 z-50" style="max-width: 340px;">
    <div class="fixed bottom-4 right-4 z-50" style="max-width: 340px;">
      <div class="cardORG">
        <div class="card__info">
          <div class="card__logo">THX Eng.Mohammed Ezzat ❤️</div>
          <div class="card__chip">
            <svg class="card__chip-lines" role="img" width="20px" height="20px" viewBox="0 0 100 100" aria-label="Chip">
              <g opacity="0.8">
                <polyline points="0,50 35,50" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="0,20 20,20 35,35" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="50,0 50,35" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="65,35 80,20 100,20" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="100,50 65,50" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="35,35 65,35 65,65 35,65 35,35" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="0,80 20,80 35,65" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="50,100 50,65" fill="none" stroke="#000" stroke-width="2"></polyline>
                <polyline points="65,65 80,80 100,80" fill="none" stroke="#000" stroke-width="2"></polyline>
              </g>
            </svg>
            <div class="card__chip-texture"></div>
          </div>
          <div class="card__type">debit</div>
          <div class="card__number">
            <span class="card__digit-group">0123</span>
            <span class="card__digit-group">4567</span>
            <span class="card__digit-group">8901</span>
            <span class="card__digit-group">2345</span>
          </div>
          <div class="card__valid-thru" aria-label="Valid thru">Valid<br>thru</div>
          <div class="card__exp-date"><time datetime="2038-01">01/38</time></div>
          <div class="card__name" aria-label="Dee Stroyer">ORGANZA</div>
          <div class="card__vendor" role="img" aria-labelledby="card-vendor">
            <span id="card-vendor" class="card__vendor-sr">Mastercard</span>
          </div>
          <div class="card__texture"></div>
        </div>
      </div>

      
      <!-- floatingWindow -->
      <div id="floatingWindow" class="floating-window p-8 blur-bg">
        <div class="text-center">
          <h2 class="text-2xl font-bold text-white mb-4" style="color: rgb(240, 231, 213); font-size: 40px;">
            <img src="Image/LOGO_CARD-removebg-preview.png" alt="">
            <b>Welcome to our project !!!!!</b>
          </h2>
          <p class="text-white mb-6" style="font-size: 30px; color: rgb(240, 231, 213);">
            This isn’t just any project — it’s your personal AI detective, <br>sniffing out suspicious credit card
            activity before it even gets a chance to say “cha-ching!”

            Powered by machine learning and a love for clean data.
          </p>
          <button class="btn-31" id="closeButton">
            <span class="text-container">
              <span class="text">Start</span>
            </span>
          </button>
        </div>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const floatingWindow = document.getElementById('floatingWindow');
          const closeButton = document.getElementById('closeButton');

          closeButton.addEventListener('click', function () {
            floatingWindow.classList.add('hide');

            setTimeout(function () {
              floatingWindow.style.display = 'none';
            }, 600);
          });
        });
      </script>
      <script src="JS/imask.min.js"></script>
      <script src="JS/chart.umd.min.js"></script>
      <script src="JS/p5.min.js"></script>
      <script src="JS/vanta.topology.min.js"></script>
      <script src="JS/script.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
      <script>
        window.addEventListener('DOMContentLoaded', function () {
          const timeInput = document.getElementById('time');
          if (timeInput) {
            const now = new Date();
            // Get hours and minutes in 2-digit format
            const hh = String(now.getHours()).padStart(2, '0');
            const mm = String(now.getMinutes()).padStart(2, '0');
            timeInput.value = `${hh}:${mm}`;
          }
        });
      </script>

      <script>
        document.getElementById('get-location-btn').onclick = function () {
          const status = document.getElementById('user-location-status');
          if (!navigator.geolocation) {
            status.textContent = "Geolocation is not supported by your browser.";
            return;
          }
          status.textContent = "Detecting...";
          navigator.geolocation.getCurrentPosition(
            function (position) {
              const lat = position.coords.latitude.toFixed(4);
              const lon = position.coords.longitude.toFixed(4);
              document.getElementById('user_lat').value = lat;
              document.getElementById('user_lon').value = lon;
              status.textContent = `Acquired: (${lat}, ${lon})`;
            },
            function (error) {
              status.textContent = "Unable to retrieve your location.";
            }
          );
        };
      </script>
      <script>
        const map = L.map('map').setView([30.0444, 31.2357], 15);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        let marker;

        const merchLatInput = document.getElementById('merch_lat');
        const merchLongInput = document.getElementById('merch_long');

        map.on('click', function (e) {
          const lat = e.latlng.lat;
          const lng = e.latlng.lng;
          merchLatInput.value = lat;
          merchLongInput.value = lng;

          document.getElementById('show_merch_lat').textContent = lat.toFixed(6);
          document.getElementById('show_merch_long').textContent = lng.toFixed(6);



          if (marker) {
            marker.setLatLng([lat, lng]);
          } else {
            marker = L.marker([lat, lng]).addTo(map);
          }
        });

      </script>
      <audio id="fraud-audio" src="Alarm.mp3" preload="auto"></audio>

      <script>
        document.getElementById('get-location-btn').onclick = function () {
          const status = document.getElementById('user-location-status');
          const resultBox = document.getElementById('location-result');
          if (!navigator.geolocation) {
            status.textContent = "Geolocation is not supported by your browser.";
            resultBox.innerHTML = `
      <div class="card">
        <svg class="wave" viewBox="0 0 1440 320"><path d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z" fill-opacity="1"></path></svg>
        <div class="icon-container">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon"><path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"></path></svg>
        </div>
        <div class="message-text-container">
          <p class="message-text" style="color:#b91c1c;">Geolocation not supported</p>
          <p class="sub-text">Your browser does not support location detection.</p>
        </div>
      </div>
    `;
            return;
          }
          status.textContent = "Detecting...";
          resultBox.innerHTML = `
    <div class="card">
      <svg class="wave" viewBox="0 0 1440 320"><path d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z" fill-opacity="1"></path></svg>
      <div class="icon-container">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><circle cx="256" cy="256" r="208" fill="#facc15"/><path d="M256 144v112l96 56" stroke="#b45309" stroke-width="32" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div class="message-text-container">
        <p class="message-text" style="color:#b45309;">Detecting your location...</p>
        <p class="sub-text">Please wait while we get your location.</p>
      </div>
    </div>
  `;
          navigator.geolocation.getCurrentPosition(
            function (position) {
              const lat = position.coords.latitude.toFixed(4);
              const lon = position.coords.longitude.toFixed(4);
              document.getElementById('user_lat').value = lat;
              document.getElementById('user_lon').value = lon;
              status.textContent = `Acquired: (${lat}, ${lon})`;
              resultBox.innerHTML = `
        <div class="card">
          <svg class="wave" viewBox="0 0 1440 320"><path d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z" fill-opacity="1"></path></svg>
          <div class="icon-container">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon"><path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"></path></svg>
          </div>
          <div class="message-text-container">
            <p class="message-text">Location detected: <b>${lat}</b>, <b>${lon}</b></p>
            <p class="sub-text">Your location was acquired successfully.</p>
          </div>
        </div>
      `;
            },
            function (error) {
              status.textContent = "Unable to retrieve your location.";
              resultBox.innerHTML = `
        <div class="card">
          <svg class="wave" viewBox="0 0 1440 320"><path d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z" fill-opacity="1"></path></svg>
          <div class="icon-container">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" class="icon"><path fill="currentColor" d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
          </div>
          <div class="message-text-container">
            <p class="message-text" style="color:#b91c1c;">Unable to retrieve your location.</p>
            <p class="sub-text">Please check your browser permissions.</p>
          </div>
        </div>
      `;
            }
          );
        };
      </script>
      <script>
        document.getElementById("fraudForm").addEventListener("submit", function (e) {
          e.preventDefault();

          const requiredFields = [
            "cardnumber",
            "amount",
            "time",
            "zipcode",
            "gender",
            "category-grid"
          ];
          let missing = false;
          requiredFields.forEach(id => {
            const el = document.getElementById(id);
            if (!el || !el.value) missing = true;
          });

          const userLatVal = document.getElementById("user_lat").value;
          const userLonVal = document.getElementById("user_lon").value;
          const merchLatVal = document.getElementById("merch_lat").value;
          const merchLonVal = document.getElementById("merch_long").value;

          if (
            missing ||
            userLatVal === "" || userLonVal === "" ||
            merchLatVal === "" || merchLonVal === ""
          ) {
            alert("Please fill in all fields and select both your location and the merchant's location on the map.");
            return;
          }

          const timeValue = document.getElementById("time").value;
          const now = new Date();

          const hour = timeValue
            ? parseInt(timeValue.split(":")[0], 10)
            : now.getHours();
          const day = now.getDate();
          const month = now.getMonth() + 1;

          const userLat = Number(document.getElementById("user_lat").value);
          const userLon = Number(document.getElementById("user_lon").value);
          const merchLat = Number(document.getElementById("merch_lat").value);
          const merchLon = Number(document.getElementById("merch_long").value);

          const distance = haversine(userLat, userLon, merchLat, merchLon);

          // const data = {
          //   cc_num: Number(document.getElementById("cardnumber").value.replace(/\s/g, "")),
          //   category: document.getElementById("category-grid").value,
          //   amt: Number(document.getElementById("amount").value),
          //   gender: document.getElementById("gender").value,
          //   zip: Number(document.getElementById("zipcode").value),
          //   // lat: userLat,
          //   lat: 64.7556,
          //   // long: userLon,
          //   long: -165.6723,
          //   // merch_lat: merchLat,
          //   merch_lat: 65.65414200000001,
          //   // merch_long: merchLon,
          //   merch_long: -164.722603,
          //   hour: hour,
          //   day: day,
          //   month: month,
          //   // distance: distance
          //   distance: 4940.6
          // };



          const data = {
            cc_num: Number(document.getElementById("cardnumber").value.replace(/\s/g, "")),
            category: document.getElementById("category-grid").value,
            amt: Number(document.getElementById("amount").value),
            gender: document.getElementById("gender").value,
            zip: Number(document.getElementById("zipcode").value),
            lat: userLat,
            long: userLon,
            merch_lat: merchLat,
            merch_long: merchLon,
            hour: hour,
            day: day,
            month: month,
            distance: distance
          };

          document.getElementById("loadingSpinner").classList.remove("hidden");
          console.log("Data sent to backend:", data);

          fetch("http://localhost:5000/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          })
            .then((res) => res.json())
            .then((result) => {

              document.getElementById("loadingSpinner").classList.add("hidden");
              if (result.prediction === 1) {
                // Play fraud sound
                const audio = document.getElementById('fraud-audio');
                if (audio) audio.play();
              }


              document.getElementById("resultSection").innerHTML =
                result.prediction === 1
                  ? `
    <!-- From Uiverse.io by chase2k25 -->
    <div class="containero">
      <div class="left-sideo">
        <div class="cardo">
          <div class="card-lineo"></div>
          <div class="buttonso"></div>
        </div>
        <div class="posto">
          <div class="post-lineo"></div>
          <div class="screeno">
            <div class="icono">!</div>
          </div>
          <div class="numberso"></div>
          <div class="numbers-line2o"></div>
        </div>
      </div>
      <div class="right-sideo">
        <div class="newo">Fraud Transaction</div>
        <svg class="arrowo" xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 451.846 451.847">
          <path d="M345.441 248.292L151.154 442.573c-12.359 12.365-32.397 12.365-44.75 0-12.354-12.354-12.354-32.391 0-44.744L278.318 225.92 106.409 54.017c-12.354-12.359-12.354-32.394 0-44.748 12.354-12.359 32.391-12.359 44.75 0l194.287 194.284c6.177 6.18 9.262 14.271 9.262 22.366 0 8.099-3.091 16.196-9.267 22.373z" class="active-path" fill="#ffffff"></path>
        </svg>
      </div>
    </div>
    `
                  : `
    <!-- From Uiverse.io by Admin12121 -->
    <div class="containereee">
      <div class="left-sideeee">
        <div class="cardeee">
          <div class="card-lineeee"></div>
          <div class="buttonseee"></div>
        </div>
        <div class="posteee">
          <div class="post-lineeee"></div>
          <div class="screeneee">
            <div class="dollar">$</div>
          </div>
          <div class="numberseee"></div>
          <div class="numbers-line2eee"></div>
        </div>
      </div>
      <div class="right-sideeee">
        <div class="new">Not Fraud Transaction</div>
        <svg viewBox="0 0 451.846 451.847" height="512" width="512" xmlns="http://www.w3.org/2000/svg" class="arrow"><path fill="#cfcfcf" data-old_color="#000000" class="active-path" data-original="#000000" d="M345.441 248.292L151.154 442.573c-12.359 12.365-32.397 12.365-44.75 0-12.354-12.354-12.354-32.391 0-44.744L278.318 225.92 106.409 54.017c-12.354-12.359-12.354-32.394 0-44.748 12.354-12.359 32.391-12.359 44.75 0l194.287 194.284c6.177 6.18 9.262 14.271 9.262 22.366 0 8.099-3.091 16.196-9.267 22.373z"></path></svg>
      </div>
    </div>
    `;
            })
            .catch((err) => {
              document.getElementById("loadingSpinner").classList.add("hidden");
              alert("Erorr in Server");
              console.error(err);
            });
        });
      </script>
</body>

</html>